(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{3954:function(t,e,n){"use strict";var r=n("a76b"),o=n.n(r);o.a},"3b82":function(t,e,n){"use strict";var r=n("ece3"),o=n.n(r);o.a},"78cf":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r}));var r={mixLoading:function(){return n.e("components/mix-loading/mix-loading").then(n.bind(null,"50c5"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t._f("price")(t.goodsTotal,2)),r=t._f("price")(t.payTotal,2),o=t._f("price")(t.payTotal,2);t.$mp.data=Object.assign({},{$root:{f0:n,f1:r,f2:o}})},a=[]},a76b:function(t,e,n){},b553:function(t,e,n){"use strict";n.r(e);var r=n("78cf"),o=n("e2bc");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("3954"),n("3b82");var s,u=n("f0c5"),i=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,"076a53fb",null,!1,r["a"],s);e["default"]=i.exports},d791:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=s(n("a34a")),o=n("5df6"),a=n("c15d");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e,n,r,o,a,s){try{var u=t[a](s),i=u.value}catch(c){return void n(c)}u.done?e(i):Promise.resolve(i).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){u(a,r,o,s,i,"next",t)}function i(t){u(a,r,o,s,i,"throw",t)}s(void 0)}))}}var c=function(){n.e("pages/order/components/product-list").then(function(){return resolve(n("4fa1"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("pages/order/components/coupon-select").then(function(){return resolve(n("0a07"))}.bind(null,n)).catch(n.oe)},f={components:{productList:c,couponSelect:d},data:function(){return{remarks:"",addr:{},data:{products:[],coupons:[]},curCoupon:{},payTotal:0,fullReductionMoney:0,points_sum:0,points_money:0,is_check_points:0,addressData:[]}},computed:{goodsTotal:function(){if(0===this.data.products.length)return 0;var t=0;return this.data.products.forEach((function(e){t+=e.price*e.number})),t}},onLoad:function(t){"cart"===t.type?(this.createType="cart",this.cartIds=t.ids):this.createType="buyNow",this.loadData()},methods:{getAddress:function(){var t=this;return i(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,a.getAddress)();case 2:n=e.sent,1===n.status&&n.result.address_lists&&n.result.address_lists.length&&(o=n.result.address_lists.find((function(t){return 1===t.is_default})),t.addr=o);case 4:case"end":return e.stop()}}),e)})))()},loadData:function(){var t=this;return i(r.default.mark((function e(){var n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.getAddress(),t.loaded=!0,n=t.getOpenerEventChannel(),n.once("goodsData",(function(e){t.data.products=e,console.log("goodsData",e),t.getOrderPayPrice()}));case 4:case"end":return e.stop()}}),e)})))()},getOrderPayPrice:function(){var t=this;return i(r.default.mark((function e(){var n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.getOrderPayPrice)({order_amount:t.goodsTotal,is_check_points:t.is_check_points});case 2:n=e.sent,t.payTotal=n.result.total_amount||0,t.fullReductionMoney=n.result.discount_amount,t.points_sum=n.result.points_sum,t.points_money=n.result.points_money;case 7:case"end":return e.stop()}}),e)})))()},changePayPoints:function(){this.is_check_points=0===this.is_check_points?1:0,this.getOrderPayPrice()},createOrder:function(){var e=this;this.$util.throttle(i(r.default.mark((function n(){var a,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.addr.address_id){n.next=3;break}return e.$util.msg("请选择收货地址"),n.abrupt("return");case 3:return e.isLoading=!0,a=e.getCreateData(),n.next=7,(0,o.createOrder)(a);case 7:s=n.sent,e.isLoading=!1,1===s.status?("cart"===e.createType&&e.$store.commit("deleteAllCartOrders"),t.redirectTo({url:"/pages/wallet/pay?data="+JSON.stringify({sourcePage:"createOrder",pay_price:e.payTotal,order_id:s.result.order_id})})):e.$util.msg(s.msg);case 10:case"end":return n.stop()}}),n)}))))},getCreateData:function(){var t={remarks:this.remarks,address_id:this.addr.address_id,buy_type:1,order_amount:this.goodsTotal,total_amount:this.payTotal,is_check_points:this.is_check_points};return t.goods=this.data.products.map((function(t){return{goods_id:t.id,number:t.number,item_id:t.sku.id}})),t},setAddress:function(t){this.addr=t,this.getOrderPayPrice()},showCouponPopup:function(){this.data.coupons.length>0&&(this.$refs.couponSelect.curCoupon=this.curCoupon,this.$refs.couponSelect.open())},onCheckCoupon:function(t){this.curCoupon=t,this.getOrderPayPrice()}}};e.default=f}).call(this,n("543d")["default"])},e2bc:function(t,e,n){"use strict";n.r(e);var r=n("d791"),o=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=o.a},ece3:function(t,e,n){},f616:function(t,e,n){"use strict";(function(t){n("f37f");r(n("66fd"));var e=r(n("b553"));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])}},[["f616","common/runtime","common/vendor"]]]);