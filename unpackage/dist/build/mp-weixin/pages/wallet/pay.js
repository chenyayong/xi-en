(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/wallet/pay"],{"5f5a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n("a34a")),a=n("5df6");function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))}}var c=function(){n.e("pages/wallet/components/success-modal").then(function(){return resolve(n("f2b4"))}.bind(null,n)).catch(n.oe)},u={components:{successModal:c},data:function(){return{curType:"wxpay",data:{}}},computed:{userInfo:function(){return this.$store.state.userInfo}},onLoad:function(e){var t=JSON.parse(e.data);this.data=t},methods:{confirm:function(){var e=this;this.$util.throttle((function(){if("balance"===e.curType){if(!e.userInfo.money||e.userInfo.money<e.data.pay_price)return e.$util.msg("余额不足"),void e.$refs.confirmBtn.stop();if(!e.userInfo.pay_password)return e.$refs.mixModal.open(),void e.$refs.confirmBtn.stop();e.$refs.pwdKeyboard.open(),e.$refs.confirmBtn.stop()}else e.payByUnipay()}))},balancePay:function(e){var t=this;return s(r.default.mark((function n(){var a;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$request("order","payOrder",{order_id:t.data.order_id,pay_password:e,pay_type:t.curType},{showLoading:!0});case 2:a=n.sent,1===a.status?(t.$store.dispatch("getUserInfo"),t.$refs.pwdKeyboard.close(),t.$refs.successModal.open()):(t.$util.msg(a.msg),t.$refs.pwdKeyboard.pwd="");case 4:case"end":return n.stop()}}),n)})))()},h5Pay:function(e){var t=this;function n(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appid,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(t.$refs.confirmBtn.death(),t.$refs.successModal.open())}))}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n)):n()},weixinPay:function(t){var n=this,r=t.timeStamp,a=t.nonceStr,o=t.paySign,i={timeStamp:r,nonceStr:a,paySign:o,package:t.package,signType:"MD5",success:function(e){n.$refs.confirmBtn.death(),n.$refs.successModal.open()},fail:function(e){n.$refs.confirmBtn.stop(),e.errMsg.indexOf("取消")>-1||e.errMsg.indexOf("cancel")>1||e.errMsg.indexOf("-2")>-1?n.$util.msg("取消支付"):(n.$util.msg("支付遇到错误，请稍候重试"),console.log(e))}};e.requestPayment(i)},payByUnipay:function(){var e=this;return s(r.default.mark((function t(){var n,o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=a.payOrder,t.t1=e.data.order_id,t.t2=e.$store.state.userInfo.mini_openid,t.next=5,e.getMpCode("weixin");case 5:return t.t3=t.sent,t.t4={order_id:t.t1,openid:t.t2,pay_type:1,pay_code:t.t3},t.next=9,(0,t.t0)(t.t4);case 9:if(n=t.sent,1===n.status){t.next=15;break}return e.$refs.confirmBtn.stop(),console.log(n),e.$util.msg(n.msg||"获取支付信息失败"),t.abrupt("return");case 15:o=n.result,e.weixinPay(o);case 17:case"end":return t.stop()}}),t)})))()},successCallback:function(){switch(this.data.sourcePage){case"createOrder":e.redirectTo({url:"/pages/order/detail?id="+this.data.order_id});break;case"orderList":this.$util.prePage().refreshList(!1),e.redirectTo({url:"/pages/order/detail?id="+this.data.order_id});break;case"orderDetail":this.$util.prePage().loadData(),e.navigateBack();break}},checkType:function(e){this.curType=e},getMpCode:function(t){return new Promise((function(n){e.login({provider:t,success:function(e){n(e.code)}})}))}}};t.default=u}).call(this,n("543d")["default"])},"7ea4":function(e,t,n){"use strict";var r=n("859d"),a=n.n(r);a.a},"7f48":function(e,t,n){"use strict";n.r(t);var r=n("5f5a"),a=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"859d":function(e,t,n){},"87fa":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={mixButton:function(){return n.e("components/mix-button/mix-button").then(n.bind(null,"0975"))},payPasswordKeyboard:function(){return n.e("components/pay-password-keyboard/pay-password-keyboard").then(n.bind(null,"84fd"))},mixLoading:function(){return n.e("components/mix-loading/mix-loading").then(n.bind(null,"50c5"))},mixModal:function(){return n.e("components/mix-modal/mix-modal").then(n.bind(null,"53f7"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e._f("price")(e.data.pay_price,2));e.$mp.data=Object.assign({},{$root:{f0:n}})},o=[]},"8bdd":function(e,t,n){"use strict";n.r(t);var r=n("87fa"),a=n("7f48");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("7ea4");var i,s=n("f0c5"),c=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,"5abef2bc",null,!1,r["a"],i);t["default"]=c.exports},a0dd:function(e,t,n){"use strict";(function(e){n("f37f");r(n("66fd"));var t=r(n("8bdd"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])}},[["a0dd","common/runtime","common/vendor"]]]);