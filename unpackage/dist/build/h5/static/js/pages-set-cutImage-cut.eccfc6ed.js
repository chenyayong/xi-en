(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-set-cutImage-cut"],{"2c98":function(t,e,n){"use strict";n.r(e);var o=n("4d44"),i=n("4aaf");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("978b");var c,r=n("f0c5"),u=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"7237cc7a",null,!1,o["a"],c);e["default"]=u.exports},"4aaf":function(t,e,n){"use strict";n.r(e);var o=n("625af"),i=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},"4d44":function(t,e,n){"use strict";var o;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"content"},[n("v-uni-view",{staticClass:"title-view",style:{height:t.navigationBarHeight+"px"}},[n("v-uni-navigator",{staticClass:"back-btn mix-icon icon-xiangzuo",attrs:{"open-type":"navigateBack"}}),n("v-uni-text",{staticClass:"title"},[t._v("裁剪")]),n("v-uni-text",{staticClass:"empty"})],1),n("v-uni-view",{staticClass:"cropper-wrapper"},[n("v-uni-canvas",{staticClass:"cropper",style:{width:t.cropperOpt.width,height:t.cropperOpt.height},attrs:{"disable-scroll":"true","canvas-id":"cropper"},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"cropper-buttons"},[n("v-uni-view",{staticClass:"btn upload",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadTap.apply(void 0,arguments)}}},[t._v("重选")]),n("v-uni-view",{staticClass:"btn getCropperImage",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.getCropperImage.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)},a=[]},"625af":function(t,e,n){"use strict";var o=n("4ea4");n("ace4"),n("d3b7"),n("ac1f"),n("1276"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("2954"),n("649e"),n("219c"),n("b39a"),n("72f7"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("a668")),a=uni.getSystemInfoSync(),c=a.windowWidth,r=a.windowHeight,u={data:function(){return{cropperOpt:{id:"cropper",width:c,height:r,scale:2.5,zoom:8,cut:{x:(c-200)/2,y:(r-this.systemInfo.navigationBarHeight-this.systemInfo.statusBarHeight-200)/2,width:200,height:200}},weCropper:""}},computed:{navigationBarHeight:function(){return console.log(this.systemInfo.navigationBarHeight),this.systemInfo.navigationBarHeight}},onLoad:function(t){var e=this.cropperOpt,n=t.src;console.log(n),n&&(Object.assign(e,{src:n}),this.weCropper=new i.default(e).on("ready",(function(t){})).on("beforeImageLoad",(function(t){})).on("imageLoad",(function(t){uni.hideToast()})))},methods:{touchStart:function(t){this.weCropper.touchStart(t)},touchMove:function(t){this.weCropper.touchMove(t)},touchEnd:function(t){this.weCropper.touchEnd(t)},convertBase64UrlToBlob:function(t,e){for(var n=atob(t.split(",")[1]),o=[],i=0;i<n.length;i++)o.push(n.charCodeAt(i));return new Blob([new Uint8Array(o)],{type:e},{filename:"1111.jpg"})},blobToDataURL:function(t){var e=new FileReader;e.readAsDataURL(t),e.onload=function(t){var e=t.target.result;console.log(e)}},getCropperImage:function(){var t=this;this.weCropper.getCropperImage((function(e){e?(t.$util.prePage().setAvatar(e),uni.navigateBack()):console.log("获取图片失败，请稍后重试")}))},uploadTap:function(){var t=this;uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var n=e.tempFilePaths[0];t.weCropper.pushOrign(n)}})}}};e.default=u},"74cf":function(t,e,n){var o=n("24fb");e=o(!1),e.push([t.i,'@charset "UTF-8";\n/* 配色 */uni-page-body[data-v-7237cc7a], .content[data-v-7237cc7a]{width:100%;height:100%;overflow:hidden}.content[data-v-7237cc7a]{display:flex;flex-direction:column;background-color:#000;padding-top:0}.title-view[data-v-7237cc7a]{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;width:100%;background:transparent}.title-view .back-btn[data-v-7237cc7a]{display:flex;justify-content:center;align-items:center;width:42px;height:40px;font-size:18px;color:#fff}.title-view .title[data-v-7237cc7a]{font-size:17px;color:#fff}.title-view .empty[data-v-7237cc7a]{width:42px}.cropper[data-v-7237cc7a]{width:100%;flex:1}.cropper-wrapper[data-v-7237cc7a]{flex:1;position:relative;display:flex;flex-direction:column;justify-content:space-between;align-items:center;width:100%;background-color:#000}.cropper-buttons[data-v-7237cc7a]{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;width:100%;height:50px;background-color:rgba(0,0,0,.4)}.cropper-buttons .btn[data-v-7237cc7a]{width:100px;height:50px;line-height:50px;font-size:15px;color:#fff}.cropper-buttons .btn.upload[data-v-7237cc7a]{padding-left:20px}.cropper-buttons .btn.getCropperImage[data-v-7237cc7a]{padding-right:20px;text-align:right}',""]),t.exports=e},"978b":function(t,e,n){"use strict";var o=n("eb18"),i=n.n(o);i.a},a668:function(t,e,n){n("a4d3"),n("e01a"),n("d28b"),n("cb29"),n("4160"),n("c975"),n("fb6a"),n("b64b"),n("d3b7"),n("3ca3"),n("159b"),n("ddb0"),function(e,n){t.exports=n()}(0,(function(){"use strict";var t=void 0,e=["touchstarted","touchmoved","touchended"];function n(t){return t.charAt(0).toUpperCase()+t.slice(1)}function o(t){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];e.forEach((function(e,n){void 0!==o[n]&&(t[e]=o[n])}))}function i(t,e){Object.defineProperties(t,e)}function a(){return t||(t=wx.getSystemInfoSync()),t}"function"===typeof Symbol&&Symbol.iterator;var c=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=function(){function t(t,e){var n=[],o=!0,i=!1,a=void 0;try{for(var c,r=t[Symbol.iterator]();!(o=(c=r.next()).done);o=!0)if(n.push(c.value),e&&n.length===e)break}catch(u){i=!0,a=u}finally{try{!o&&r["return"]&&r["return"]()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s={},d={id:{default:"cropper",get:function(){return s.id},set:function(t){s.id=t}},width:{default:750,get:function(){return s.width},set:function(t){s.width=t}},height:{default:750,get:function(){return s.height},set:function(t){s.height=t}},scale:{default:2.5,get:function(){return s.scale},set:function(t){s.scale=t}},zoom:{default:5,get:function(){return s.zoom},set:function(t){s.zoom=t}},src:{default:"cropper",get:function(){return s.src},set:function(t){s.src=t}},cut:{default:{},get:function(){return s.cut},set:function(t){s.cut=t}},onReady:{default:null,get:function(){return s.ready},set:function(t){s.ready=t}},onBeforeImageLoad:{default:null,get:function(){return s.beforeImageLoad},set:function(t){s.beforeImageLoad=t}},onImageLoad:{default:null,get:function(){return s.imageLoad},set:function(t){s.imageLoad=t}},onBeforeDraw:{default:null,get:function(){return s.beforeDraw},set:function(t){s.beforeDraw=t}}};function l(){var t=this,e=a(),n=e.windowWidth;t.attachPage=function(){var e=getCurrentPages(),n=e[e.length-1];n.wecropper=t},t.createCtx=function(){var e=t.id;e&&(t.ctx=wx.createCanvasContext(e))},t.deviceRadio=n/750,t.deviceRadio=t.deviceRadio.toFixed(2)}function f(){var t=this,e=["ready","beforeImageLoad","beforeDraw","imageLoad"];t.on=function(o,i){return e.indexOf(o)>-1&&"function"===typeof i&&("ready"===o?i(t):t["on"+n(o)]=i),t}}function h(){var t=this,e=t.deviceRadio,n=t.width,o=t.height,i=t.cut,a=i.x,c=void 0===a?0:a,r=i.y,u=void 0===r?0:r,s=i.width,d=void 0===s?n:s,l=i.height,f=void 0===l?o:l;t.updateCanvas=function(){return t.croperTarget&&t.ctx.drawImage(t.croperTarget,t.imgLeft,t.imgTop,t.scaleWidth,t.scaleHeight),"function"===typeof t.onBeforeDraw&&t.onBeforeDraw(t.ctx,t),t.setBoundStyle(),t.ctx.draw(),t},t.pushOrign=function(e){return t.src=e,"function"===typeof t.onBeforeImageLoad&&t.onBeforeImageLoad(t.ctx,t),uni.getImageInfo({src:e,success:function(n){var o=n.width/n.height;t.croperTarget=n.path||e,o<d/f?(t.rectX=c,t.baseWidth=d,t.baseHeight=d/o,t.rectY=u-Math.abs((f-t.baseHeight)/2)):(t.rectY=u,t.baseWidth=f*o,t.baseHeight=f,t.rectX=c-Math.abs((d-t.baseWidth)/2)),t.imgLeft=t.rectX,t.imgTop=t.rectY,t.scaleWidth=t.baseWidth,t.scaleHeight=t.baseHeight,t.updateCanvas(),"function"===typeof t.onImageLoad&&t.onImageLoad(t.ctx,t)}}),t.update(),t},t.getCropperImage=function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];var a=t.id,r=toString.call(o[0]);switch(r){case"[object Object]":var s=o[0].quality,l=void 0===s?10:s;uni.canvasToTempFilePath({canvasId:a,x:c,y:u,fileType:"jpg",width:d,height:f,destWidth:d*l/(10*e),destHeight:f*l/(10*e),success:function(t){"function"===typeof o[o.length-1]&&o[o.length-1](t.tempFilePath)}});break;case"[object Function]":uni.canvasToTempFilePath({canvasId:a,x:c,y:u,fileType:"jpg",width:d,height:f,destWidth:d,destHeight:f,success:function(t){"function"===typeof o[o.length-1]&&o[o.length-1](t.tempFilePath)}});break}return t}}function p(){var t=this;t.src&&(t.__oneTouchStart=function(e){t.touchX0=e.x,t.touchY0=e.y},t.__oneTouchMove=function(e){var n=void 0,o=void 0;if(t.touchended)return t.updateCanvas();n=e.x-t.touchX0,o=e.y-t.touchY0;var i=t.rectX+n,a=t.rectY+o;t.outsideBound(i,a),t.updateCanvas()},t.__twoTouchStart=function(e,n){var o=void 0,i=void 0,a=void 0;t.touchX1=t.rectX+t.scaleWidth/2,t.touchY1=t.rectY+t.scaleHeight/2,o=n.x-e.x,i=n.y-e.y,a=Math.sqrt(o*o+i*i),t.oldDistance=a},t.__twoTouchMove=function(e,n){var o=void 0,i=void 0,a=void 0,c=t.scale,r=t.zoom;o=n.x-e.x,i=n.y-e.y,a=Math.sqrt(o*o+i*i),t.newScale=t.oldScale+.001*r*(a-t.oldDistance),t.newScale<=1&&(t.newScale=1),t.newScale>=c&&(t.newScale=c),t.scaleWidth=t.newScale*t.baseWidth,t.scaleHeight=t.newScale*t.baseHeight;var u=t.touchX1-t.scaleWidth/2,s=t.touchY1-t.scaleHeight/2;t.outsideBound(u,s),t.updateCanvas()},t.__xtouchEnd=function(){t.oldScale=t.newScale,t.rectX=t.imgLeft,t.rectY=t.imgTop})}var v={touchStart:function(t){var e=this,n=u(t.touches,2),i=n[0],a=n[1];i.x||(i.x=i.clientX,i.y=i.clientY,a&&(a.x=a.clientX,a.y=a.clientY)),o(e,!0,null,null),e.__oneTouchStart(i),t.touches.length>=2&&e.__twoTouchStart(i,a)},touchMove:function(t){var e=this,n=u(t.touches,2),i=n[0],a=n[1];i.x||(i.x=i.clientX,i.y=i.clientY,a&&(a.x=a.clientX,a.y=a.clientY)),o(e,null,!0),1===t.touches.length&&e.__oneTouchMove(i),t.touches.length>=2&&e.__twoTouchMove(i,a)},touchEnd:function(t){var e=this;o(e,!1,!1,!0),e.__xtouchEnd()}};function g(){var t=this,e=(t.deviceRadio,t.width),n=t.height,o=t.cut,i=o.x,a=void 0===i?0:i,c=o.y,r=void 0===c?0:c,u=o.width,s=void 0===u?e:u,d=o.height,l=void 0===d?n:d;t.outsideBound=function(e,n){t.imgLeft=e>=a?a:t.scaleWidth+e-a<=s?a+s-t.scaleWidth:e,t.imgTop=n>=r?r:t.scaleHeight+n-r<=l?r+l-t.scaleHeight:n},t.setBoundStyle=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=o.color,c=void 0===i?"#04b00f":i,u=o.mask,d=void 0===u?"rgba(0, 0, 0, 0.5)":u,f=o.lineWidth,h=void 0===f?1:f;t.ctx.beginPath(),t.ctx.setFillStyle(d),t.ctx.fillRect(0,0,a,n),t.ctx.fillRect(a,0,s,r),t.ctx.fillRect(a,r+l,s,n-r-l),t.ctx.fillRect(a+s,0,e-a-s,n),t.ctx.fill(),t.ctx.beginPath(),t.ctx.setStrokeStyle(c),t.ctx.setLineWidth(h),t.ctx.moveTo(a-h,r+10-h),t.ctx.lineTo(a-h,r-h),t.ctx.lineTo(a+10-h,r-h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(c),t.ctx.setLineWidth(h),t.ctx.moveTo(a-h,r+l-10+h),t.ctx.lineTo(a-h,r+l+h),t.ctx.lineTo(a+10-h,r+l+h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(c),t.ctx.setLineWidth(h),t.ctx.moveTo(a+s-10+h,r-h),t.ctx.lineTo(a+s+h,r-h),t.ctx.lineTo(a+s+h,r+10-h),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.setStrokeStyle(c),t.ctx.setLineWidth(h),t.ctx.moveTo(a+s+h,r+l-10+h),t.ctx.lineTo(a+s+h,r+l+h),t.ctx.lineTo(a+s-10+h,r+l+h),t.ctx.stroke()}}var b="1.1.4",x=function(){function t(e){c(this,t);var n=this,o={};return i(n,d),Object.keys(d).forEach((function(t){o[t]=d[t].default})),Object.assign(n,o,e),n.prepare(),n.attachPage(),n.createCtx(),n.observer(),n.cutt(),n.methods(),n.init(),n.update(),n}return r(t,[{key:"init",value:function(){var t=this,e=t.src;return t.version=b,"function"===typeof t.onReady&&t.onReady(t.ctx,t),e&&t.pushOrign(e),o(t,!1,!1,!1),t.oldScale=1,t.newScale=1,t}}]),t}();return Object.assign(x.prototype,v),x.prototype.prepare=l,x.prototype.observer=f,x.prototype.methods=h,x.prototype.cutt=g,x.prototype.update=p,x}))},cb29:function(t,e,n){var o=n("23e7"),i=n("81d5"),a=n("44d2");o({target:"Array",proto:!0},{fill:i}),a("fill")},eb18:function(t,e,n){var o=n("74cf");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=n("4f06").default;i("9f885958",o,!0,{sourceMap:!1,shadowMode:!1})}}]);